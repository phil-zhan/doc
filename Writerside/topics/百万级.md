# 百万级excel数据导入数据库

## 1. Excel读取的内存溢出问题
>思考：如何防止内存溢出？
{style="note"}

借助 <font color="red"> **EasyExcel** </font> 来完成 **Excel** 文件的读取，因为它不会一次性的把整个 **Excel** 都加载到内存当中，而是逐行读取的，这样就可以避免内存溢出

## 2. 性能问题 
>思考：如何在更短的时间内完成大量的数据导入？ 
{style="note"}
    
为了提升性能，我们进一步再将百万级的数据分散到不同的 **sheet** 页当中，借助线程池，再多线程同时去读取不同的 **sheet** 页，
在读取过程当中，借助 **EasyExcel** 的 **read listener** 来做数据处理，在处理过程当中，我们并不会每一条都去插入数据库，因为这样对数据库的压力太大，我们会把从 **Excel** 中读取到的数据暂存到内存当中，比如说使用一个 **list**，当读取到 **1000** 条之后，再执行一次批量插入，批量的插入，可以借助 **mybatis** 就能很简单的实现。

## 3. 错误处理问题
>思考：如何避免出错，以及如果出错了该怎么解决？
{style="note"}

为了避免数据插入过程中的失败异常，我们可以做一些数据的前置检查，把数据的完整性，重复性等检查都前置处理掉  
在批量插入过程中，我们要使用事物，如果遇到失败，可以在代码中 **重试几次** ，如果还是失败，就 **回滚处理** ，再 **记录失败日志**  
而这个过程中，需要考虑一些并发的问题，所以我们在处理的时候，要使用线程安全的队列，来保存暂存在内存当中的数据 **如：ConcurrentLinkedQueue**
