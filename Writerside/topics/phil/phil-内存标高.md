# phil-内存标高

### 1. 查看标高进程

```Shell
# 直接执行TOP命令【大写的 M 可以按照内存排序】
top
```

### 2. jstat查看jvm信息

##### 2.1 gc

```Shell

### 查看GC当前情况
jstat -gc <PID>
```

以下是一次输出示例，中文注释是单独加上去的

| S0C                 | S1C                 | S0U                   | S1U                   | EC            | EU              | OC           | OU             | MC               | MU                  | CCSC         | CCSU           | YGC          | YGCT              | FGC         | FGCT            | CGC      | CGCT           | GCT          |
|---------------------|---------------------|-----------------------|-----------------------|---------------|-----------------|--------------|----------------|------------------|---------------------|--------------|----------------|--------------|-------------------|-------------|-----------------|----------|----------------|--------------|
| Survivor 0 区的容量（字节） | Survivor 1 区的容量（字节） | Survivor 0 区已使用空间（字节） | Survivor 1 区已使用空间（字节） | Eden 区的容量（字节） | Eden 区已使用空间（字节） | Old 区的容量（字节） | Old 区已使用空间（字节） | Metaspace 容量（字节） | Metaspace 已使用空间（字节） | 压缩类空间的容量（字节） | 压缩类空间已使用空间（字节） | Young GC 的次数 | Young GC 所用的时间（秒） | Full GC 的次数 | Full GC 所用时间（秒） | 总 GC 的次数 | 所有 GC 所用的时间（秒） | GC 所用的总时间（秒） |
| 0.0                 | 86016.0             | 0.0                   | 86016.0               | 7286784       | 4059136         | 4333568      | 3064753        | 138444           | 132879.5            | 17356.0      | 15146.3        | 28024        | 587.154           | 0           | 0.000           | 25164    | 98.648         | 685.802      |

> Young GC、Full GC和总GC是JVM进行垃圾回收时的三种不同类型：
> {style="note"}

- Young GC：也称Minor GC，是指发生在年轻代的垃圾回收。年轻代由 Eden 区和两个 Survivor 区组成，当Eden 区满时就会触发
  Young GC。在 Young GC 中，存活期较短的对象会被移动到 Survivor 区，当某个对象在 Survivor 区中经历了足够的次数（默认为
  15 次），就会被移动到老年代中。Young GC 的速度比 Full GC 快很多，一般可以很快完成。

- Full GC：也称为 Major GC，是指在老年代进行的垃圾回收。Full GC 会将整个堆空间进行垃圾回收，包括年轻代和老年代。在堆空间不足、永久代（JDK7及之前版本使用，JDK8
  使用 Metaspace）满或 Full GC 间隔超过设置的最大时间时，会触发 Full GC。虽然 Full GC
  可以回收大量的内存空间，但是其速度相对较慢，可能会导致应用程序暂停很长时间，影响应用程序的性能。

- 总GC：也称Full GC 和 Young GC 的总和。在进行总GC时，同时进行年轻代和老年代的回收，可以清理堆中的大部分未被使用空间，但是可能会导致较长时间的停顿。

- 总之，Young GC 和 Full GC 是针对堆内存中不同区域的垃圾回收，而总GC是对整个堆空间进行垃圾回收。由于 Young GC 和
  Full GC
  的算法和策略不同，所以它们的速度和回收的对象也是不同的。开发者需要根据具体的应用场景来选择哪种GC策略更适合应用程序的需求，以达到更好的性能。

##### 2.2 gc capacity

```Shell

### 查看GC三代中的容量情况
jstat -gccapacity <PID>
```

以下是一次输出示例，中文注释是单独加上去的

| 参数    | 备注                  | Value      |
|-------|---------------------|------------|
| NGCMN | 最小新生代内存 (字节)        | 0.0        |
| NGCMX | 最大新生代内存 (字节)        | 26214400.0 |
| NGC   | 当前新生代内存容量 (字节)      | 7372800.0  |
| S0C   | S0 Survivor空间 (K字节) | 0.0        |
| S1C   | S1 Survivor空间 (K字节) | 139264.0   |
| EC    | Eden空间容量 (K字节)      | 7233536.0  |
| OGCMN | 最小老年代内存 (字节)        | 0.0        |
| OGCMX | 最大老年代内存 (字节)        | 26214400.0 |
| OGC   | 当前老年代内存容量 (字节)      | 4333568.0  |
| OC    | 压缩后老年代内存 (字节)       | 4333568.0  |
| MCMN  | 最小元空间容量 (字节)        | 0.0        |
| MCMX  | 最大元空间容量 (K字节)       | 1171456.0  |
| MC    | 当前元空间容量 (K字节)       | 138444.0   |
| CCSMN | 最小压缩类空间 (字节)        | 0.0        |
| CCSMX | 最大压缩类空间 (K字节)       | 1048576.0  |
| CCSC  | 当前压缩类空间 (K字节)       | 17356.0    |
| YGC   | 年轻代垃圾回收次数           | 28027      |
| FGC   | 完全垃圾回收次数            | 0          |
| CGC   | 卡表垃圾回收次数            | 25164      |

##### 2.3 gc util

```Shell
### 三代空间的使用统计
jstat -gcutil <PID>
```

以下是一次输出示例，中文注释是单独加上去的

| 参数   | 注释            | Value    |
|------|---------------|----------|
| S0   | S0 Survivor空间 | 0.00%    |
| S1   | S1 Survivor空间 | 100.00%  |
| E    | Eden空间        | 81.31%   |
| O    | 老年代           | 73.57%   |
| M    | 元空间           | 96.02%   |
| CCS  | 压缩类空间         | 87.27%   |
| YGC  | 年轻代垃圾回收次数     | 28027    |
| YGCT | 年轻代垃圾回收时间     | 587.213秒 |
| FGC  | 完全垃圾回收次数      | 0        |
| FGCT | 完全垃圾回收时间      | 0.000秒   |
| CGC  | 卡表垃圾回收次数      | 25164    |
| CGCT | 卡表垃圾回收时间      | 98.648秒  |
| GCT  | 总垃圾回收时间       | 685.860秒 |

> Young GC、Full GC和总GC是JVM进行垃圾回收时的三种不同类型：
> {style="note"}

- 年轻代垃圾回收（Young GC）：年轻代垃圾回收主要处理新生代（Young Generation）中的垃圾对象。一般情况下，新分配的对象会被分配到Eden
  空间，当 Eden 空间不足时，就会触发一次年轻代垃圾回收。在回收过程中，不仅会清理 Eden
  空间中的垃圾对象，还会将存活的对象移动到存活区（Survivor Space）。

- 完全垃圾回收（Full GC）：完全垃圾回收是对整个
  Java堆进行的垃圾回收操作，包括年轻代和老年代。它的目标是清理整个堆，释放所有不再使用的对象，并进行内存碎片整理。完全垃圾回收通常会导致应用程序暂停执行，停顿时间较长。

- 卡表垃圾回收（CMS）：卡表垃圾回收是一种基于并发的垃圾回收算法，用于回收老年代中的垃圾对象。它分为多个阶段，其中并发标记阶段是其中的一个关键步骤。在并发标记阶段，应用程序仍在运行，同时会占用一定的
  CPU 资源，对系统有一定的负载压力。卡表垃圾回收的目标是减少垃圾回收的停顿时间，提高应用程序的性能和响应速度。

##### 2.4 gc new

```Shell
### 年轻代的对象信息
jstat -gcnew <PID>
```

以下是一次输出示例，中文注释是单独加上去的

| 参数   | 注释              | Value       |
|------|-----------------|-------------|
| S0C  | S0 Survivor 容量  | 0.0MB       |
| S1C  | S1 Survivor 容量  | 60.0MB      |
| S0U  | S0 Survivor 已使用 | 0.0MB       |
| S1U  | S1 Survivor 已使用 | 60.0MB      |
| TT   | Tenured 区使用率    | 15.0%       |
| MTT  | 最大 Tenured 区使用率 | 15.0%       |
| DSS  | 代空间总容量          | 429.6875MB  |
| EC   | Eden 区使用容量      | 6981.5625MB |
| EU   | Eden 区实际使用      | 1405.8125MB |
| YGC  | 年轻代垃圾回收次数       | 28033次      |
| YGCT | 年轻代垃圾回收时间       | 587.346秒    |

### 3. jstack 查看线程信息

### 4. jmap 查看堆内存信息

```Shell
## 查看最大的对象实例
jmap -histo <PID> | head -10
```

jmap参数如下

| 参数                         | 含义                                                                   |
|----------------------------|----------------------------------------------------------------------|
| -clstats 【pid】             | 连接到运行中的进程并打印类加载器的统计信息【包括类信息、加载的数量和卸载的数量等】                            |
| -finalizerinfo 【pid】       | 连接到运行中的进程并打印有待 Finalize 的对象的信息                                       |
| -histo[:live] 【pid】        | 连接到运行中的进程并打印 Java 堆中对象的直方图，如果指定了子选项 “live”，则只计算活动对象【包括对象的数量、大小和类信息等】 |
| -dump:【dump-options】 【pid】 | 连接到运行中的进程并 Dump Java 堆                                               |
|                            | dump-options:                                                        |
|                            | live：只 Dump 活动对象；如果未指定，则 Dump 堆中的所有对象                                |
|                            | format=b：以二进制格式 Dump 堆信息                                             |
|                            | file=【file】：将堆信息 Dump 到指定的文件                                         |
|                            | 示例：jmap -dump:live,format=b,file=heap.bin 【pid】                      |
| -? -h --help               | 打印帮助信息                                                               |
